# 221208_TS_(2)

## Certbot failed to authenticate some domains 에러 해결

### 상황

![image](https://user-images.githubusercontent.com/93081720/206478373-89c7a2fb-4d80-4fd7-afb5-99c825c267df.png)

AWS EC2에 SSAFY 동기들의 자율 프로젝트 배포를 위해 Nginx를 설치하고 letsencrpyt standalone 방식으로 ssl 설정을 하려고 도메인에 대해 인증키를 발급받으려 했는데, 다음과 같이 `Certbot failed to authenticate some domains`라는 에러가 발생하였다.

해당 도메인에 대해 인증키를 발급할 수 없다는 에러였다.

그동안 배포를 여러 번 하면서 ssl 인증키를 발급하면서 에러를 마주친 적이 없어서 당황했다.

### 경과

2가지 경우가 의심되었다.

첫째는 이전에 프로젝트 기간에 해당 도메인으로 발급된 키가 있어서 에러가 발생하는 것이라고 의심했다.

둘째는 다른 EC2 인스턴스를 연결하다보니 새 인스턴스와 연결된 Route 53의 주소가 연결하려는 도메인에 반영하는데에 시간이 걸려서 그런게 아닌가 의심했다. (가비아에 등록된 도메인의 네임서버가 바뀐 것이 적용되는데 시간이 걸린다고 생각했다.)

<br>

그냥 마냥 기다릴 수 없으니 그냥 `www`를 뺀 도메인에 대해서 ssl 인증서를 발급받아 https를 적용했다. 해당 도메인으로 들어가서 웹 페이지를 열어보니 ssl 인증이 제대로 적용되어 있음을 확인할 수 있었다.

그런데 생각해보니 www를 뺐는데 왜 ssl 인증서가 정상적으로 발급되고 ssl이 정상 적용되었지? 라는 생각이 들었다.

### 원인

매우 어이가 없는 이유 때문에 에러를 마주하고 있었다.

동기가 발급받은 도메인은 `www`를 뺀 것이 정상이었다.

### 조치

도메인에서 `www`를 빼주니 모든 것이 해결

### 결론

기존에 ssl 인증서 발급을 시도하던 도메인에서 `www`를 뺀 것이 정상이었다!

그러니까 아무 생각 없이 일단 이거라도 한번 해보자 하고 시도했던 도메인이 올바른 도메인이었다.

어제 내 공통 프로젝트를 배포하면서 나는 가비아에서 발급받은 도메인에 `www`를 연결해줘서 동기도 나와 동일하게 `www`가 붙은 것을 설정했을 것이라 생각했던 나의 큰 실수였다.

생각해보니 프론트의 `.env`파일에 있는 base api 주소와 백엔드의 `application.yml`파일에서 `www`를 뺀 도메인을 여러 번 봤는데, 무의식적으로 지나쳤던 나의 실수였다.